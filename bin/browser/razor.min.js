/*
  RazorJS 0.3.4
  Copyright (c) 2013 Andy Edinborough (@andyedinborough)
  Released under MIT License
*/
!function(a,b,c){"use strict";function d(a){return a&&~a.toString().indexOf("[native code]")?a:void 0}function e(a){return n(arguments,function(b,c){0!==c&&b&&n(r(b),function(c){a[c]=b[c]})}),a}function f(a){return a.split("\\").join("\\\\").split("\r").join("\\r").split("\n").join("\\n").split('"').join('\\"')}function g(a){return{toString:function(){return a},isHtmlString:!0}}function h(a){return(null===a||a===c)&&(a=""),a.isHtmlString?a:("string"!=typeof a&&(a+=""),a=a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;"),g(a))}function i(a){return(a=a||"").substr(a.length-1)}function j(a){var b,c,d,e,f=new u(a),g=arguments[1]||0,h=arguments[2]||0,k=[],l=[],m=[],n=function(){if(c=f.peek(),"*"===c)f.readUntil("*@");else if("("===c)d=f.readBlock("(",")"),k.push(d.substr(1,d.length-2),1);else if("{"===c)d=f.readBlock("{","}"),k.push(j(d.substr(1,d.length-2),g+1,1).join("\n"));else if(":"===c&&1===h){for(d=f.readUntil("\n","@","}");"@"===d.next&&"@"===f.peek();){var a=f.readUntil("\n","@","}");d.value+=a.value,d.next=a.next}f.seek(-1),d.value=d.value.substr(1),k.push(d.value,2)}else if("i"===c&&"if"===f.peek(2)||"d"===c&&"do"===f.peek(2)||"f"===c&&"for"===f.peek(3)||"w"===c&&"while"===f.peek(5)||"h"===c&&"helper"===f.peek(6)||"s"===c&&"switch"===f.peek(6)||"s"===c&&"section"===f.peek(7)){if(d=f.readBlock("{","}"),"i"===c)for(;!f.eof();){var n=f.readWhitespace();if(!n)break;if("else"!==f.peek(4)){f.seek(-n.length);break}d+=n+f.readBlock("{","}")}var o=j(d.substr(0,d.length-1),g+1,1).join("\r\n	"),p=o.indexOf("(");e=o.indexOf("{"),(-1===p||p>e)&&(p=e),"h"===c?l.push("function "+o.substring(7,e)+"{"+z+o.substr(e+1)+'\nreturn html.raw(writer.join(""));\n}\n'):"s"===c&&"switch"!=d.substr(0,6)?m.push("sections."+o.substr(8,p-8)+" = function () {"+z+o.substr(e+1)+'\nreturn writer.join("");\n}\n'):k.push(o+"}")}else if(c&&!v.test(i(b.value))){var q,r;for(d="";!f.eof()&&(q=f.text.substr(f.position+1),r=q.match(v))&&(d+=f.read(r[0].length),c=f.peek());)if("["===c||"("===c){q=f.readBlock(c,"["===c?"]":")"),"("===c&&/\s*function[\s*\(]/.test(q)?(e=q.indexOf("{"),d+=q.substr(0,e),d+=j(q.substr(e),g+1,1).join("\r\n	")):d+=q;break}d&&k.push(d,1)}else 0===h&&b.next&&k.push("@",2)};for(k.push=function(a){return function(b,c){"string"==typeof b&&(b=[b]),b=o(b,function(a){return"undefined"!=typeof a.code?a:new y(a,c)}),a.apply(this,b)}}(k.push);!f.eof()&&(b=0===h?f.readUntil("@"):f.readQuotedUntil("@","<"));)if(c=f.peek(),"@"!==c||"@"!==b.next){for(;;){if(c=f.peek(),1===h&&"<"===b.next){var p=!1,q=(f.text.substr(f.position+1,30).match(w)||0)[0]||"";if(!q){var r=f.readQuotedUntil("@","<");b.value+=b.next+r.value,b.next=r.next;continue}for(k.push(b.value,0);!f.eof()&&(b=f.readUntil("@",">"),"@"==b.next);)k.push((p?"":"<")+b.value,2),p=!0,n();if(d=b+"","/"!==i(b.value)){for(var s,t=1;t>0&&(s=f.readQuotedUntil(["</"+q,"<"+q]),d+=s,!f.eof());)t+="/"===s.next.substr(1,1)?-1:1;d+=f.readQuotedUntil(">")}p||(d="text"===q?d.substr(5,d.length-5-7):"<"+d),k.push(j(d,g+1,0))}else b.value&&(0===h?k.push(b.value,2):k.push(b.value));break}n()}else f.read(),k.push(b.value+c,2);return g>0?k:{code:k.join("\r\n"),sections:m,helpers:l}}function k(a,b){var d,f=j(a);f=(x.options.strict?'"use strict";\r\n':"")+A.replace("@code",f.helpers.join("\r\n")+"\r\n"+f.sections.join("\r\n")+f.code);try{d=new Function("bind","sections","undefined",f)}catch(h){if(x.options.onerror(h,f)!==!1)throw h.message+": "+f}return function i(a,f,h){if(!h&&"function"==typeof f)return i(a,null,f);var j=e(new x.BasePage,b,f),k={};j.model=a,j.html.page=j,j.html.model=a;var l=d.apply(j,[s,k]);if(j.layout){var m=function(a){var b=a(null,{renderBody:function(){return g(l)},viewBag:j.viewBag,isSectionDefined:function(a){return"function"==typeof k[a]},renderSection:function(a,b){if(this.isSectionDefined(a)){var c=g(k[a]());return c}if(b)throw'Section "'+a+'" not found.'}},h);return h?void 0:b},n=x.view(j.layout,null,h?m:c);if(!h)return m(n)}else{if(!h)return l;h(l)}}}function l(a,b,d){if(!d&&"function"==typeof b)return l(a,c,b);var e="~/"+a,f=B[e],g=C[e],h=x.getViewEtag(a);if(!f||h!==g||x.options.cacheDisabled){var i=function(a){a&&(f=B[e]=x.compile(a,b),C[e]=h),d&&d(f)};return f=x.findView(a,d?i:null),d||i(f),f}return d?(d(f),void 0):f}var m=function(a){return function(b,c){return a.apply(b,[c])}},n=m(d(Array.prototype.forEach)||function(b,c){for(var d,e=this.length,f=e,g=c||a;f--;)b.apply(g,[this[d=e-f-1],d])}),o=m(d(Array.prototype.map)||function(b,c){for(var d=c||a,e=[],f=0,g=this.length;g>f;++f)e.push(b.call(d,this[f],f,this));return e}),p=m(d(Array.prototype.some)||function(b,c){for(var d=c||a,e=0,f=this.length;f>e;++e)if(b.call(d,this[e],e,this))return!0;return!1}),q=["toString","valueOf"],r=d(Object.keys)||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return n(q,function(c){a[c]!==Object.prototype[c]&&b.push(c)}),b},s=m(Function.prototype.bind||function(a,b){return function(){return a.apply(b,arguments)}}),t=function(){};e(t.prototype,{encode:h,attributeEncode:h,raw:g,renderPartial:function(a,b,c){return g(x.view(a)(b,c||this.page))}});var u=function(){function a(a,b,c){function e(b){return f=b.length,j=g[f]||(g[f]=a.peek(f)),j===b}for(var f,g=[],h="",j="";!a.eof();){if(g.length=0,c===p(b,e))return c?a.seek(f):(j=i(h),h=h.length>0?h.substr(0,h.length-1):""),d.create(h,j);if(j=a.read(),!j)break;h+=j}return d.create(h,j)}var b=function(a){this.text=(a||"")+"",this.position=-1,this.length=this.text.length},d=b.Chunk=function(a,b){return this.value=a||"",this.next=b||"",a||b?(this.length=(this.value+this.next).length,void 0):""};return e(d.prototype,{length:0,toString:function(){return this.value+this.next+""}}),d.create=function(a,b){return a||b?new d(a,b):""},e(b.prototype,{eof:function(){return this.position>=this.length},read:function(a){var b=this.peek(a);return this.position=Math.min(this.length,this.position+(a||1)),b},readAll:function(){if(this.position>=this.length)return c;var a=this.text.substr(this.position+1);return this.position=this.length,a},peek:function(a){return this.position+1>=this.length?c:this.text.substr(this.position+1,a||1)},seek:function(a,b){return this.position=Math.max(0,Math.min(this.length,(0===b?0:2===b?this.length:this.position)+(a||1))),this.position===this.length},readUntil:function(b){return"string"==typeof b&&(b=[].slice.call(arguments)),a(this,b,!0)},readWhile:function(b){return"string"==typeof b&&(b=[].slice.call(arguments)),a(this,b,!1)}}),b}(),v=/^[a-z0-9\._]+/i,w=/^[a-z]+(?:\:[a-z]+)?/i;u.prototype.readWhitespace=function(){return this.readWhile("\r","\n","	"," ")},u.prototype.readQuoted=function(a){for(var b,c="";;){if(b=this.readUntil(a),!b)break;if(c+=b.value+b.next,"\\"!==i(b.value))break}return c},u.prototype.readQuotedUntil=function(a){var b,c="";for("string"==typeof a&&(a=[].slice.call(arguments)),a=['"',"'","@*"].concat(a);b=this.readUntil(a);)if(c+=b.value,'"'===b.next||"'"===b.next)c+=b.next+this.readQuoted(b.next);else{if("@*"!==b.next)break;this.readUntil("*@")}return u.Chunk.create(c,b.next)},u.prototype.readBlock=function(a,b,c){var d,e=[a,b],f="";for(c=c||0;d=this.readUntil(e);){if(f+=d.value,d.next===a?c++:d.next===b&&c--,0===c)return f+=d.next;f+=d.next}return f};var x,y=function(a,b){this.code=a||"",this.type=b||0};e(y.prototype,{type:0,code:"",toString:function(){var a=this.code;return 0===this.type?a:2===this.type?'writeLiteral("'+f(a)+'");':"write("+a+");"}});var z="var writer = [], writeLiteral = function(a) { writer.push(a); }, write = function(a){ writeLiteral(html.encode(a)); };\n",A=z+"var page = this, model = page.model, viewBag = this.viewBag, html = this.html,\n"+"	isSectionDefined = this.isSectionDefined ? bind(this.isSectionDefined, this) : undefined,\n"+"	renderSection = this.renderSection ? bind(this.renderSection, this) : undefined,\n"+"	renderBody = this.renderBody ? bind(this.renderBody, this) : undefined,\n"+"	_layout = this.layout, layout;\n"+'@code\nif(_layout !== layout) { this.layout = layout; }\nreturn writer.join("");\n',B={},C={};x={utils:{extend:e,bind:s,Cmd:y,htmlString:g,encode:h},options:{strict:!0,onerror:function(){},cacheDisabled:!1},view:l,compile:k,parse:j,findView:null,BasePage:function(){this.viewBag||(this.viewBag={}),this.html||(this.html=new t)},HtmlHelper:t,render:function(a,b,c,d){var e;return k(a)(b,c,function(a){e=a,d&&d(e)}),e},getViewEtag:null,views:B,etags:C};var D=a.document.getElementsByTagName("script");x.findView=function(a,b){for(var c,d=0,e=D.length;e>d&&(c=D[d]);d++)if("application/x-razor-js"===c.type&&c.getAttribute("data-view-id")===a)return"function"==typeof b&&b(c.innerHTML),c.innerHTML},x.getViewEtag=function(a){return a},a.Razor=x}(window);